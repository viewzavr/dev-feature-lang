# Реакции

Необходимо реагировать на события. Реакция это у нас формально - некое развитие процесса. Она может быть описана декларативно (на компаланге) или императивно. При этом декларативность, формально, может означать как дополнение процесса некоторыми подпроцессами, так и некоторое процессное вычисление, которое в конце концов заканчивается и сворачивается. Кроме того, у нас не поддерживается пока переход в "управляющие состояния", но возможно это и не надо, а возможно выражается декларативно/императивно, а возможно это можно поддержать в будущем.

Ранее у нас уже сделан ряд "обычных" реакций (on, c-on, cc-on) и реакций в режиме "массовых модификаторов": `@objlist | x-modify { x-on "func" }`. Их стало очень много, и надо сделать что-то одно. `on` - работали с событиями объектов вьюзавр. c-on и cc-on работали с каналами. В принципе, cc-on это почти то что надо, и мы его здесь зафиксируем с новым именем `reaction`.

Для массовых реакций - пока неясно что делать.

# reaction

1. Базовая форма
```
reaction @channel @func
```
- вызывает func при каждой записи в channel. Передает аргумент - значение, которое записали в channel.

Пример:

```
d: div
reaction (dom-event @d "mousemove") {: evt | console.log( evt.clientX) :}
```


2. Поддержка {}-функций
```
reaction @channel { |value|
	...compalang-code...
}
```
создается процесс, описанный compalang-code. Он завершается, когда в коде сработает оператор `return @some-value`.
(но в целом это все пока неясно очень все). По сути, это адаптер к make-func.

3. Поддержка input
```
@channel | reaction @func
@channel | reaction { |val|
  console-log "hello" @val | return
}
...
```
В этом варианте reaction.. может возвращать что-то полезное, например исходный канал.

Примечание: поддержку нескольких каналов в стиле `reaction @channels-list @func` решено пока не делать. Вместо неё race-channels @list и т.п.

## Получение каналов
Для работы реакций нужны каналы. В синтаксисе компаланг они недоступны. Предлагаются такие методы:
```
event @obj "name" -- возвращает канал, соответствующий событию name объекта @obj. Когда в объекте срабатывает событие, производится запись в канал. Если запись в канал производится извне, то в объекте срабатывает событие.
dom-event @obj "name" -- возвращает канал, соответствующий dom-событию name объекта @obj, который является dom-элементом.
param @obj "param-name" - возвращает канал, связанный с параметром param-name. Запись в канал производится, когда значение параметра присваивается (пусть даже). Запись в канал извне приводит к установке параметра.
method @obj "name" - запись в такой канал приводит к вызову метода (привязанной функции) у obj.
```
Соображения:
1. Здесь param реагирует на присвоение параметра. Возможно, стоит реагировать только на изменение, по выбору.

## PS
но с другой стороны, хочется писать так:
reaction @someobj.attr { |value| .... }
и также
let somevar=(....)
reaction @somevar { |value| ..... }
и вот непонятно, что лучше. пока приходится делать так: reaction (create-channel @somevar) { |value| ... }

## Update доп идея

1. reaction a b c d
и сигнал на a рассылается во всех остальных, b,c,d.

2. добавить вид реакции - другой канал.
Хотя его можно выразить и как-то так: reaction @some.a (invoke (method @other "b")
ну то есть по сути речь о внедрении адаптера.